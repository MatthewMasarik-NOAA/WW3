#!/bin/sh

#SBATCH -n 140
#SBATCH --cpus-per-task=6
#SBATCH -q debug
#SBATCH -t 00:30:00
#SBATCH -A marine-cpu
#SBATCH -J ww3_regtest_14
#SBATCH -o matrix14.out

  cd /scratch1/NCEPDEV/climate/Matthew.Masarik/projs/GFS_OP/ww3/regtests

  module purge
  module use /scratch1/NCEPDEV/nems/role.epic/spack-stack/spack-stack-1.6.0/envs/unified-env-rocky8/install/modulefiles/Core
  module load stack-intel/2021.5.0
  module load stack-intel-oneapi-mpi/2021.5.1
  module load cmake/3.23.1
  module load libpng/1.6.37
  module load zlib/1.2.13
  module load jasper/2.0.32
  module load hdf5/1.14.0
  module load netcdf-c/4.9.2
  module load netcdf-fortran/4.6.1
  module load bacio/2.4.1
  module load g2/3.4.5
  module load w3emc/2.10.0
  module load esmf/8.6.0
  module load scotch/7.0.4
  export METIS_PATH=/scratch1/NCEPDEV/climate/Matthew.Masarik/waves/opt/hera/intel/spack-stack/1.6.0/parmetis-4.0.3/install
  export path_build_root=/scratch1/NCEPDEV/climate/Matthew.Masarik/projs/GFS_OP/ww3/regtests/buildmatrix14
  [[ -d ${path_build_root} ]] && rm -rf ${path_build_root}
  echo ' '
  echo '             **********************************************'
  echo '           ***  WAVEWATCH III matrix - gfs op testcase    ***'
  echo '             **********************************************'
  echo ' '
  echo ' '

  ./bin/run_cmake_test -b slurm -o all -S -T -s MPI_OMPH -w work_a -m grdset_a -f -p srun -n 140  -t 4 ../model ww3_ufs1.2

  [[ -d ${path_build_root} ]] && rm -rf ${path_build_root}*
  echo ' '
  echo '     **************************************************************'
  echo '     *  end of WAVEWATCH III       ----     GFS op testcase       *'
  echo '     **************************************************************'
  echo ' '
